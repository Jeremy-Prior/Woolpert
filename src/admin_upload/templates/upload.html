
{% extends "geonode_base.html" %}
{% load static %}
{% block body %}
<h1>Upload Data</h1>

<form method="post" >
    {% csrf_token %}
    <div class="form-group">
        <label>Database host </label>
        <input type="text" id="database_host"  name="database_host" class="form-control" required/>
    </div>
    <div class="form-group">
        <label>Database name </label>
        <input type="text" id="database_name" name="database_name" class="form-control" required/>
    </div>
    <div class="form-group">
        <label>Username </label>
        <input type="text" id="database_user" name="database_user" class="form-control" required/>
    </div>
    <div class="form-group">
        <label>Password </label>
        <input type="password" id="database_psw" name="database_psw" class="form-control" required/>
    </div>
    <div class="form-group">
        <label>Select a layer</label>
        <select class="form-control" name="layer" id="selectLayer" required>
            {% for layer in layers %}
                <option value="{{layer.name}}">{{ layer }}</option>
            {% endfor %}
        </select>
    </div>
    <div class="form-group">
        <label>Upload file (only xls, xlsx and zip containing esri files are allowed. For excel only the first worksheet is processed)</label>
        <input type="file" class="form-control" id="excel_file"/>
        <br>
        <button id="showData" name="file" type="button" class="btn btn-secondary" style="width: 100%; display: none;" onclick="show()">Edit Data</button>
    </div>

    <div id="showTableData" style="display: none;">
        <label>Select Data to upload</label>
        <div id="excel_data" class="mt-5" style="overflow-x: scroll;overflow-y: scroll;max-height: 500px;"></div>
        <br>
        <div style="display: flex; flex-direction: row;">
            <div>
                <button type="button" class="btn btn-secondary" onclick="selectAll()" style="margin-right: 5px;">Select All</button>
            </div>
            <div>
                <button type="button" class="btn btn-secondary" onclick="unselectAll()">Unselect All</button>
            </div>
        </div>
    </div>

    <br>

    <div id="finished" class="alert alert-success alert-dismissible" style="display: none;">
        <p id="finished_msg"></p>
    </div>

    <div id="finished_warning" class="alert alert-warning alert-dismissible" style="display: none;">
        <p id="finished_msg_war"></p>
    </div>

    <div id="error" class="alert alert-danger alert-dismissible" style="display: none;">
        <p id="error_msg">Could not connect to the database. Incorrect credentials</p>
    </div>
    
    <div id="wrong_format" class="alert alert-danger alert-dismissible" style="display: none;">
        Only .xlsx, .xls and .shape file format are allowed
    </div>

    <div id="zip_error" class="alert alert-danger alert-dismissible" style="display: none;">
        The zip file could not be read. Mandatory parts of the shp do not exist
    </div>
    <br>
    <button type="button" onclick="scanData()" class="btn btn-primary">Scan data</button>
    <button type="button" id="submitFinal" onclick="submitData()" class="btn btn-primary" disabled>Submit</button>

</form>
{% endblock %}

{% block extra_script %}
<script src="https://cdnjs.cloudflare.com/ajax/libs/proj4js/2.3.3/proj4.js"></script>
<script type="text/javascript" src="{% static 'js/xlsx.js' %}"></script>
<script type="text/javascript" src="{% static 'js/jszip.js' %}"></script>
<script type="text/javascript" src="{% static 'js/jszip-utils.js' %}"></script>
<script type="text/javascript" src="{% static 'js/preprocess.js' %}"></script>
<script src="{% static 'js/shapefile.js' %}"></script>
<script src="{% static 'js/fancytable.min.js' %}"></script>
<script src="{% static 'js/main.js' %}"></script>

{% endblock %}
